<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Hotshell demo - docker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.12.0/moment.min.js"></script>

    <style>/* todo find a way to retrieve the colors from formatter/formatter.go */

body {
    font-family: "Lucida Console", Monaco, monospace;
}

.executed-cmd {
    color: #3765a4;
    margin-bottom: 25px;
}

.active-menu, .parent-menu, .prompt {
    color: #c49f06;
}

.actions, .prompt, .items {
    margin-top: 15px;
}

.key, .cmd {
    color: #4e9a0c;
}

.item-desc, .cmd {
     margin-left: 10px;
 }

.active-menu {
    text-decoration: underline;
}

.time {
    color: grey;
}

.menu, .executed-cmd {
    margin-left: 10px;
}

.menu, .executed-cmd {
    margin-bottom: 15px;
}

.stdout {
    margin-top: 30px;
    margin-bottom: 30px;
}

.blinking-cursor {
  color: #2E3D48;
  -webkit-animation: 1s blink step-end infinite;
  -moz-animation: 1s blink step-end infinite;
  -ms-animation: 1s blink step-end infinite;
  -o-animation: 1s blink step-end infinite;
  animation: 1s blink step-end infinite;
}

@keyframes "blink" {
  from, to {
    color: transparent;
  }
  50% {
    color: black;
  }
}

@-moz-keyframes blink {
  from, to {
    color: transparent;
  }
  50% {
    color: black;
  }
}

@-webkit-keyframes "blink" {
  from, to {
    color: transparent;
  }
  50% {
    color: black;
  }
}

@-ms-keyframes "blink" {
  from, to {
    color: transparent;
  }
  50% {
    color: black;
  }
}

@-o-keyframes "blink" {
  from, to {
    color: transparent;
  }
  50% {
    color: black;
  }
}</style>
</head>
<body>
<div id="container"></div>
<script>

var item = 
{
    desc: 'docker',
    cmd: '',
    items: [
        
            {key: 'p', item: 
{
    desc: 'ps',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'ps all',
    cmd: 'docker ps -a',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'ps running',
    cmd: 'docker ps',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'c', item: 
{
    desc: 'containers',
    cmd: '',
    items: [
        
            {key: 'i', item: 
{
    desc: 'inspect',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'all',
    cmd: 'docker inspect $(docker ps -a -q)',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'all running',
    cmd: 'docker inspect $(docker ps -q)',
    items: [
        
    ]
}
},
        
            {key: '0', item: 
{
    desc: '/thirsty_liskov (jekyll/jekyll)',
    cmd: 'docker inspect ff895320423f',
    items: [
        
    ]
}
},
        
            {key: '1', item: 
{
    desc: '/high_bohr (ubuntu)',
    cmd: 'docker inspect 4001493bca69',
    items: [
        
    ]
}
},
        
            {key: '2', item: 
{
    desc: '/tender_heisenberg (ubuntu)',
    cmd: 'docker inspect 7c12b00793ce',
    items: [
        
    ]
}
},
        
            {key: '3', item: 
{
    desc: '/pedantic_stonebraker (ubuntu)',
    cmd: 'docker inspect 536d403d2788',
    items: [
        
    ]
}
},
        
            {key: '4', item: 
{
    desc: '/admiring_hugle (ubuntu)',
    cmd: 'docker inspect 5d26ded97278',
    items: [
        
    ]
}
},
        
            {key: '5', item: 
{
    desc: '/reverent_shaw (ubuntu)',
    cmd: 'docker inspect 693e8afa8105',
    items: [
        
    ]
}
},
        
            {key: '6', item: 
{
    desc: '/berserk_visvesvaraya (ubuntu)',
    cmd: 'docker inspect f28ff75bd658',
    items: [
        
    ]
}
},
        
            {key: '7', item: 
{
    desc: '/hopeful_shirley (ubuntu)',
    cmd: 'docker inspect 18a2ab497dd6',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 's', item: 
{
    desc: 'start',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'all',
    cmd: 'docker start $(docker ps -a -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -a -q)',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'all running',
    cmd: 'docker start $(docker ps -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -q)',
    items: [
        
    ]
}
},
        
            {key: '0', item: 
{
    desc: '/thirsty_liskov (jekyll/jekyll)',
    cmd: 'docker start ff895320423f && docker inspect --format="{{.Name}} {{.State.Status}}" ff895320423f',
    items: [
        
    ]
}
},
        
            {key: '1', item: 
{
    desc: '/high_bohr (ubuntu)',
    cmd: 'docker start 4001493bca69 && docker inspect --format="{{.Name}} {{.State.Status}}" 4001493bca69',
    items: [
        
    ]
}
},
        
            {key: '2', item: 
{
    desc: '/tender_heisenberg (ubuntu)',
    cmd: 'docker start 7c12b00793ce && docker inspect --format="{{.Name}} {{.State.Status}}" 7c12b00793ce',
    items: [
        
    ]
}
},
        
            {key: '3', item: 
{
    desc: '/pedantic_stonebraker (ubuntu)',
    cmd: 'docker start 536d403d2788 && docker inspect --format="{{.Name}} {{.State.Status}}" 536d403d2788',
    items: [
        
    ]
}
},
        
            {key: '4', item: 
{
    desc: '/admiring_hugle (ubuntu)',
    cmd: 'docker start 5d26ded97278 && docker inspect --format="{{.Name}} {{.State.Status}}" 5d26ded97278',
    items: [
        
    ]
}
},
        
            {key: '5', item: 
{
    desc: '/reverent_shaw (ubuntu)',
    cmd: 'docker start 693e8afa8105 && docker inspect --format="{{.Name}} {{.State.Status}}" 693e8afa8105',
    items: [
        
    ]
}
},
        
            {key: '6', item: 
{
    desc: '/berserk_visvesvaraya (ubuntu)',
    cmd: 'docker start f28ff75bd658 && docker inspect --format="{{.Name}} {{.State.Status}}" f28ff75bd658',
    items: [
        
    ]
}
},
        
            {key: '7', item: 
{
    desc: '/hopeful_shirley (ubuntu)',
    cmd: 'docker start 18a2ab497dd6 && docker inspect --format="{{.Name}} {{.State.Status}}" 18a2ab497dd6',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'e', item: 
{
    desc: 'exec -it',
    cmd: '',
    items: [
        
    ]
}
},
        
            {key: 'h', item: 
{
    desc: 'stop',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'all',
    cmd: 'docker stop $(docker ps -a -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -a -q)',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'all running',
    cmd: 'docker stop $(docker ps -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -q)',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'k', item: 
{
    desc: 'kill',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'all',
    cmd: 'docker kill $(docker ps -a -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -a -q)',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'all running',
    cmd: 'docker kill $(docker ps -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -q)',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'restart',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'all',
    cmd: 'docker restart $(docker ps -a -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -a -q)',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'all running',
    cmd: 'docker restart $(docker ps -q) && docker inspect --format="{{.Name}} {{.State.Status}}" $(docker ps -q)',
    items: [
        
    ]
}
},
        
            {key: '0', item: 
{
    desc: '/thirsty_liskov (jekyll/jekyll)',
    cmd: 'docker restart ff895320423f && docker inspect --format="{{.Name}} {{.State.Status}}" ff895320423f',
    items: [
        
    ]
}
},
        
            {key: '1', item: 
{
    desc: '/high_bohr (ubuntu)',
    cmd: 'docker restart 4001493bca69 && docker inspect --format="{{.Name}} {{.State.Status}}" 4001493bca69',
    items: [
        
    ]
}
},
        
            {key: '2', item: 
{
    desc: '/tender_heisenberg (ubuntu)',
    cmd: 'docker restart 7c12b00793ce && docker inspect --format="{{.Name}} {{.State.Status}}" 7c12b00793ce',
    items: [
        
    ]
}
},
        
            {key: '3', item: 
{
    desc: '/pedantic_stonebraker (ubuntu)',
    cmd: 'docker restart 536d403d2788 && docker inspect --format="{{.Name}} {{.State.Status}}" 536d403d2788',
    items: [
        
    ]
}
},
        
            {key: '4', item: 
{
    desc: '/admiring_hugle (ubuntu)',
    cmd: 'docker restart 5d26ded97278 && docker inspect --format="{{.Name}} {{.State.Status}}" 5d26ded97278',
    items: [
        
    ]
}
},
        
            {key: '5', item: 
{
    desc: '/reverent_shaw (ubuntu)',
    cmd: 'docker restart 693e8afa8105 && docker inspect --format="{{.Name}} {{.State.Status}}" 693e8afa8105',
    items: [
        
    ]
}
},
        
            {key: '6', item: 
{
    desc: '/berserk_visvesvaraya (ubuntu)',
    cmd: 'docker restart f28ff75bd658 && docker inspect --format="{{.Name}} {{.State.Status}}" f28ff75bd658',
    items: [
        
    ]
}
},
        
            {key: '7', item: 
{
    desc: '/hopeful_shirley (ubuntu)',
    cmd: 'docker restart 18a2ab497dd6 && docker inspect --format="{{.Name}} {{.State.Status}}" 18a2ab497dd6',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'l', item: 
{
    desc: 'logs -f',
    cmd: '',
    items: [
        
    ]
}
},
        
            {key: 't', item: 
{
    desc: 'top',
    cmd: '',
    items: [
        
            {key: '0', item: 
{
    desc: '/thirsty_liskov (jekyll/jekyll)',
    cmd: 'docker top ff895320423f',
    items: [
        
    ]
}
},
        
            {key: '1', item: 
{
    desc: '/high_bohr (ubuntu)',
    cmd: 'docker top 4001493bca69',
    items: [
        
    ]
}
},
        
            {key: '2', item: 
{
    desc: '/tender_heisenberg (ubuntu)',
    cmd: 'docker top 7c12b00793ce',
    items: [
        
    ]
}
},
        
            {key: '3', item: 
{
    desc: '/pedantic_stonebraker (ubuntu)',
    cmd: 'docker top 536d403d2788',
    items: [
        
    ]
}
},
        
            {key: '4', item: 
{
    desc: '/admiring_hugle (ubuntu)',
    cmd: 'docker top 5d26ded97278',
    items: [
        
    ]
}
},
        
            {key: '5', item: 
{
    desc: '/reverent_shaw (ubuntu)',
    cmd: 'docker top 693e8afa8105',
    items: [
        
    ]
}
},
        
            {key: '6', item: 
{
    desc: '/berserk_visvesvaraya (ubuntu)',
    cmd: 'docker top f28ff75bd658',
    items: [
        
    ]
}
},
        
            {key: '7', item: 
{
    desc: '/hopeful_shirley (ubuntu)',
    cmd: 'docker top 18a2ab497dd6',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'd', item: 
{
    desc: 'rm -f',
    cmd: '',
    items: [
        
            {key: 'a', item: 
{
    desc: 'all',
    cmd: 'docker rm -f $(docker ps -a -q)',
    items: [
        
    ]
}
},
        
            {key: 'r', item: 
{
    desc: 'all running',
    cmd: 'docker rm -f $(docker ps -q)',
    items: [
        
    ]
}
},
        
            {key: '0', item: 
{
    desc: '/thirsty_liskov (jekyll/jekyll)',
    cmd: 'docker rm -f ff895320423f',
    items: [
        
    ]
}
},
        
            {key: '1', item: 
{
    desc: '/high_bohr (ubuntu)',
    cmd: 'docker rm -f 4001493bca69',
    items: [
        
    ]
}
},
        
            {key: '2', item: 
{
    desc: '/tender_heisenberg (ubuntu)',
    cmd: 'docker rm -f 7c12b00793ce',
    items: [
        
    ]
}
},
        
            {key: '3', item: 
{
    desc: '/pedantic_stonebraker (ubuntu)',
    cmd: 'docker rm -f 536d403d2788',
    items: [
        
    ]
}
},
        
            {key: '4', item: 
{
    desc: '/admiring_hugle (ubuntu)',
    cmd: 'docker rm -f 5d26ded97278',
    items: [
        
    ]
}
},
        
            {key: '5', item: 
{
    desc: '/reverent_shaw (ubuntu)',
    cmd: 'docker rm -f 693e8afa8105',
    items: [
        
    ]
}
},
        
            {key: '6', item: 
{
    desc: '/berserk_visvesvaraya (ubuntu)',
    cmd: 'docker rm -f f28ff75bd658',
    items: [
        
    ]
}
},
        
            {key: '7', item: 
{
    desc: '/hopeful_shirley (ubuntu)',
    cmd: 'docker rm -f 18a2ab497dd6',
    items: [
        
    ]
}
},
        
    ]
}
},
        
    ]
}
},
        
            {key: 'i', item: 
{
    desc: 'images',
    cmd: '',
    items: [
        
            {key: 'l', item: 
{
    desc: 'list',
    cmd: 'docker images',
    items: [
        
    ]
}
},
        
            {key: 'd', item: 
{
    desc: 'remove all',
    cmd: 'docker rmi $(docker images -q)',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'v', item: 
{
    desc: 'volumes',
    cmd: '',
    items: [
        
            {key: 'l', item: 
{
    desc: 'list',
    cmd: 'docker volume ls',
    items: [
        
    ]
}
},
        
            {key: 'd', item: 
{
    desc: 'remove all',
    cmd: 'docker volume rm $(docker volume ls -q)',
    items: [
        
    ]
}
},
        
    ]
}
},
        
            {key: 'n', item: 
{
    desc: 'networks',
    cmd: 'docker network ls',
    items: [
        
    ]
}
},
        
            {key: 's', item: 
{
    desc: 'stats',
    cmd: 'docker stats',
    items: [
        
    ]
}
},
        
    ]
}

var filename = 'docker.hs.js'

</script>
<script type="text/babel">var Item = React.createClass({
  render: function() {
    return <div className="item">
        <span className='key'>{this.props.itemKey}</span>
        <span className={this.props.itemKey == '' || this.props.item.desc == '' ? '' : 'item-desc'} dangerouslySetInnerHTML={{__html: this.props.item.desc}}></span>
        <span className='cmd' dangerouslySetInnerHTML={{__html: this.props.item.cmd == '' && this.props.item.items.length > 0 ? '>' : this.props.item.cmd}}></span>
    </div>;
  }
});

var Menu = React.createClass({
  render: function() {
    var items = this.props.item.items.map(function(el) {
      	return <Item itemKey={el.key} item={el.item}/>
    })

    var trailLength = this.props.trail.length
    var trail = this.props.trail.map(function(item, ix){
        var isActive = ix == trailLength - 1
        return <div className={isActive ? 'active-menu' : 'parent-menu'} key={item.key}>{item.desc}</div>
    })

    return (
      <div className="menu">
        {trail}
        <div className="items">{items}</div>
        <div className="actions"><span className="key">spacebar</span> back</div>
        <div className="prompt">
            ? {this.props.userChoice ? this.props.userChoice : <span className='blinking-cursor'>|</span>}
        </div>
      </div>
    );
  }
});

var MenuController = React.createClass({
  getInitialState: function() {
    return {activatedItems: [{item: this.props.item, trail: [this.props.item]}]};
  },
  handleUserChoice: function(userChoice) {

    if (userChoice == '') return

    var lastActivatedItem = this.state.activatedItems[this.state.activatedItems.length - 1]

    var trail = lastActivatedItem.trail.slice()
    var nextItem
    if (userChoice == ' ') {
        if (trail.length == 1) return
        trail.pop()
        nextItem = trail[trail.length - 1]
        userChoice = 'spacebar'
    } else {
        nextItem = _.find(lastActivatedItem.item.items, function(el) {
            return el.key == userChoice
        })
        if (nextItem == undefined) return
        nextItem = nextItem.item
        if (nextItem.cmd != '') {
            this.state.activatedItems.push({item: nextItem})
            nextItem = lastActivatedItem.item
        } else {
            trail.push(nextItem)
        }
    }

    lastActivatedItem.userChoice = userChoice

    this.state.activatedItems.push({item: nextItem, trail: trail})
    this.setState({activatedItems: this.state.activatedItems})

    window.scrollTo(0,document.body.scrollHeight);
  },
  componentDidMount(){
      var self = this
      document.body.onkeypress = function(e){
        self.handleUserChoice(String.fromCharCode(e.which))
      };
  },
  render: function() {

    var items = this.state.activatedItems.map(function(el) {
      	return el.item.cmd == '' ?
      	    <Menu trail={el.trail} item={el.item} userChoice={el.userChoice}/> :
      	    <div>
      	        <div className='executed-cmd' dangerouslySetInnerHTML={{__html: '/bin/bash -c ' + el.item.cmd}}></div>
      	        <div className='stdout'>
      	            (the output of the command would be displayed here)
      	        </div>
            </div>
    })
    var time = moment().format('HH:mm');
    return (
      <div className="menuController">
        <div><span className="time">{time}</span> $ hs -f ./{filename}</div>
        <br/>
        {items}
      </div>
    );
  }
});

ReactDOM.render(
  <MenuController item={item} />,
  document.getElementById('container')
);</script>
</body>
</html>